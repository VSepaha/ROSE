<html>
<head>
 <title>WebApp Version 1.0</title>
</head>
<body>
	<!--This represents the first line of text on the HTML.  It displays OFF if there's nothing in the database.
	    If there is an item, it displays the state contained.                                              -->
 <br><br>
 <h1 id="status" style="text-align:center;">State: {{"OFF" if (userinputs[0] == null) else (userinputs[0].state)}}</h1>
 <h2 id="speedtext" style = "text-align:center;">Speed: {{"OFF" if (userinputs[1] == null) else (userinputs[1].speed)}}</h2>
 
 <input type="number" name="speed" id="speed" min="0" max="1" step="0.05" hidden></input>

 <div style="text-align:center;" hidden>
 	<!--The below form is a hidden object that gets posted to the database when the "...submit()" function is
 	    called.  This occurs when the GO and STOP buttons are pressed.                                       -->
 <form action="/write" method="POST" id="the_form">
  <input type="text" name="userinput" id="userinput" hidden>
  <input type="submit" value="Submit" hidden>
  <br><br>  
 </form>
 </div>
 
 <div style="text-align:center;">
  <br><br>
  <button name="forward" value="FORWARD" onmousedown="forward()" onmouseup="reset()">Forward</button> 
  <br>
  <button name="left" value="LEFT" onmousedown="left()" onmouseup="reset()">Left</button>
  <button name="backward" value="BACKWARD" onmousedown="backward()" onmouseup="reset()">Backward</button>
  <button name="right" value="RIGHT" onmousedown="right()" onmouseup="reset()">Right</button>  
 </div>
 
 <div style="text-align:right;">
 <button id="showdev" onclick="showdevtools()">Show Developer Tools</button>
 <button id="hidedev" onclick="hidedevtools()" style="display:none;">Hide Developer Tools</button>
 </div>
 <div id="devtools" style="text-align:right;visibility:hidden">
 <p id="keypressed">Key Pressed: 0</p>
 <button name="test" value="TEST" onclick="test()">Test</button>
 <br>
 <a href="./deleteall">Delete all</a>
 </div>
 
 <script>
 
   var isNorthPressed = false;
   var isSouthPressed = false;
   var isEastPressed = false;
   var isWestPressed = false;
    
   function test()
   {
   	document.getElementById("userinput").value = "STOP";
   	document.getElementById("the_form").submit();
   }
 
   function forward()
   {
   	document.getElementById("status").innerHTML = "FORWARD";
   	var xhttp;
     	xhttp = new XMLHttpRequest();
     	xhttp.open("POST", "/up", true);
     	xhttp.send("test");
   }
   function backward()
   {
   	document.getElementById("status").innerHTML = "BACKWARD";
   	var xhttp;
     	xhttp = new XMLHttpRequest();
     	xhttp.open("POST", "/down", true);
     	xhttp.send("test");
   }
   function left()
   {
   	document.getElementById("status").innerHTML = "LEFT";
   	var xhttp;
     	xhttp = new XMLHttpRequest();
     	xhttp.open("POST", "/left", true);
     	xhttp.send("test");
   }
   function right()
   {
   	document.getElementById("status").innerHTML = "RIGHT";
   	var xhttp;
     	xhttp = new XMLHttpRequest();
     	xhttp.open("POST", "/right", true);
     	xhttp.send("test");
   }
   
   document.onkeydown = checkKey;
   document.onkeyup = keyRelease;

    function checkKey(e)
    {
        e = e || window.event;
		var xhttp;
     	xhttp = new XMLHttpRequest();
     	
     	document.getElementById("keypressed").innerHTML = "Key Pressed: " + e.keyCode;
     
        if (e.keyCode == '38') 
        {
          isNorthPressed = true;
          if(isWestPressed == true)
          {
            document.getElementById("status").innerHTML = "NORTHWEST";
            xhttp.open("POST", "/northwest", true);
            xhttp.send("test");
          }
          else if (isEastPressed == true)
          {
            document.getElementById("status").innerHTML = "NORTHEAST";
            xhttp.open("POST", "/northeast", true);
            xhttp.send("test");
          }
          else
          {
                       // up arrow
                document.getElementById("status").innerHTML = "FORWARD";
                //SYNCHRONOUS VERSION
                //document.getElementById("userinput").value = "UP";
            //document.getElementById("the_form").submit();
            
            //ASYNCHRONOUS VERSION
            xhttp.open("POST", "/up", true);
            xhttp.send("test");
          }
     
        }
        else if (e.keyCode == '40')
        {
          isSouthPressed = true;
          if(isWestPressed == true)
          {
            document.getElementById("status").innerHTML = "SOUTHWEST";
            xhttp.open("POST", "/southwest", true);
            xhttp.send("test");
          }
          else if(isEastPressed == true){
            document.getElementById("status").innerHTML = "SOUTHEAST";
            xhttp.open("POST", "/southeast", true);
            xhttp.send("test");
          }
          else
          {
                           // down arrow
                document.getElementById("status").innerHTML = "BACKWARD";
                //SYNCHRONOUS VERSION
                //document.getElementById("userinput").value = "DOWN";
            //document.getElementById("the_form").submit();
            
            //ASYNCHRONOUS VERSION
            xhttp.open("POST", "/down", true);
            xhttp.send("test");
          }
 
        }
        else if (e.keyCode == '37')
        {
          isWestPressed = true;
          if(isNorthPressed == true)
          {
            document.getElementById("status").innerHTML = "NORTHWEST";
            xhttp.open("POST", "/northwest", true);
            xhttp.send("test");
          }
          else if (isSouthPressed == true)
          {
            document.getElementById("status").innerHTML = "SOUTHWEST";
            xhttp.open("POST", "/southwest", true);
            xhttp.send("test");
          }
          else
          {
                     // left arrow
                document.getElementById("status").innerHTML = "LEFT";
                //SYNCHRONOUS VERSION
                //document.getElementById("userinput").value = "LEFT";
            //document.getElementById("the_form").submit();
            
            //ASYNCHRONOUS VERSION
            xhttp.open("POST", "/left", true);
            xhttp.send("test");
          }
       
        }
        else if (e.keyCode == '39')
        {
          isEastPressed = true;
          if (isNorthPressed == true)
          {
            document.getElementById("status").innerHTML = "NORTHEAST";
            xhttp.open("POST", "/northeast", true);
            xhttp.send("test");
          }
          else if(isSouthPressed == true)
          {
            document.getElementById("status").innerHTML = "SOUTHEAST";
            xhttp.open("POST", "/southeast", true);
            xhttp.send("test");
          }
          else
          {
                     // right arrow
                document.getElementById("status").innerHTML = "RIGHT";
                //SYNCHRONOUS VERSION
                //document.getElementById("userinput").value = "RIGHT";
            //document.getElementById("the_form").submit();
            
            //ASYNCHRONOUS VERSION
            xhttp.open("POST", "/right", true);
            xhttp.send("test");
          }
       
        }
        else if (e.keyCode == '33')
        {
            // page up
            document.getElementById("speed").stepUp();
   			//ASYNCHRONOUS VERSION
   			xhttp.open("POST", "/speedup", true);
     		xhttp.send("test");
     	    document.getElementById("speedtext").innerHTML = document.getElementById("speed").value;
        }
        else if (e.keyCode == '34')
        {
            // page down
            document.getElementById("speed").stepDown();
   			//ASYNCHRONOUS VERSION
   			xhttp.open("POST", "/speeddown", true);
     		xhttp.send("test");
     	    document.getElementById("speedtext").innerHTML = document.getElementById("speed").value;
        }

    }
    
    function reset()
    {
    	document.getElementById("status").innerHTML = "STOP";
    	var xhttp;
     	xhttp = new XMLHttpRequest();
    	xhttp.open("POST", "/reset", true);
  	xhttp.send("test");
    }
    
    function keyRelease(e)
    {
    	e = e || window.event;
    	var xhttp;
     	xhttp = new XMLHttpRequest();
     	if (e.keyCode == '37' || e.keyCode == '38' || e.keyCode == '39' || e.keyCode == '40' || e.keyCode == '33' || e.keyCode == '34')
     	{
        if (e.keyCode == '38')
        { 
          //north
          isNorthPressed = false;
        }
        if (e.keyCode == '37')
        {
          //west
          isWestPressed = false;
        }
        if (e.keyCode == '39')
        {
          //east
          isEastPressed = false;
        }
        if (e.keyCode == '40')
        {
          //south
          isSouthPressed = false;
        }
     		document.getElementById("status").innerHTML = "STOP";
     		xhttp.open("POST", "/reset", true);
    		xhttp.send("test");
    	}
    	document.getElementById("keypressed").innerHTML = "Key Pressed: 0";
    }
    
    function showdevtools()
    {
    	document.getElementById("showdev").style.display="none";
    	document.getElementById("hidedev").style.display="inline";
    	document.getElementById("devtools").style.visibility="visible";
    }
    
    function hidedevtools()
    {
    	document.getElementById("showdev").style.display="inline";
    	document.getElementById("hidedev").style.display="none";
    	document.getElementById("devtools").style.visibility="hidden";
    }
    //document.getElementById("speed").value = 
    //document.getElementById("speedtext").innerHTML = document.getElementById("speed").value;
   /*
   {
   	 
     if(document.getElementById("status").innerHTML == "GO")
     {
     	document.getElementById("status").style.color = "green";
     }
     else if(document.getElementById("status").innerHTML == "STOP")
     {
     	document.getElementById("status").style.color = "red";
     }
     else
     	document.getElementById("status").style.color = "black";
   }
   */
 </script>
</body>

</html>
